@using ViewModel.Commons.Fields
@inject TooltipService TooltipService

@if (ChildContent != null)
{
    <RadzenButton Click="ExecuteCommand"
                  ButtonStyle="@GetButtonStyle()"
                  Disabled="@IsDisabled()"
                  IsBusy="@(Command?.IsBusy ?? false)"
                  MouseEnter="@ShowTooltip"
                  class="@CssClass">
        @ChildContent
    </RadzenButton>
}
else
{
    <RadzenButton Click="ExecuteCommand"
                  Text="@Command?.Text"
                  ButtonStyle="@GetButtonStyle()"
                  Disabled="@IsDisabled()"
                  IsBusy="@(Command?.IsBusy ?? false)"
                  MouseEnter="@ShowTooltip"
                  class="@CssClass" />
}

@code {
    /// <summary>
    /// The command to execute (without parameter).
    /// </summary>
    [Parameter]
    public ICommandViewModel? Command { get; set; }

    /// <summary>
    /// Optional CSS class to override the adaptive button style.
    /// </summary>
    [Parameter]
    public string? CssClass { get; set; }

    /// <summary>
    /// Optional child content for custom button text/content.
    /// If provided, this will be displayed instead of Command.Text.
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Executes the command.
    /// </summary>
    private void ExecuteCommand()
    {
        Command?.Command.Execute(null);
    }

    /// <summary>
    /// Returns true if the button should be disabled.
    /// </summary>
    private bool IsDisabled()
    {
        return Command?.IsBusy == true || Command?.IsEnabled == false;
    }

    /// <summary>
    /// Shows tooltip with the command hint on mouse enter.
    /// </summary>
    private void ShowTooltip(ElementReference elementReference)
    {
        if (!string.IsNullOrEmpty(Command?.Hint))
        {
            TooltipService.Open(elementReference, Command.Hint);
        }
    }

    /// <summary>
    /// Gets the Radzen ButtonStyle based on Command.Style.
    /// </summary>
    private ButtonStyle GetButtonStyle()
    {
        return (Command?.Style ?? CommandStyle.Default) switch
        {
            CommandStyle.Primary => ButtonStyle.Primary,
            CommandStyle.Success => ButtonStyle.Success,
            CommandStyle.Danger => ButtonStyle.Danger,
            CommandStyle.Warning => ButtonStyle.Warning,
            CommandStyle.Info => ButtonStyle.Info,
            CommandStyle.Light => ButtonStyle.Light,
            CommandStyle.Dark => ButtonStyle.Dark,
            _ => ButtonStyle.Secondary
        };
    }
}
