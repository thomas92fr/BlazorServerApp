@using ViewModel.Commons.Fields
@using ViewModel.Fields

<div class="mb-3">
    @if (!string.IsNullOrEmpty(Field?.Label))
    {
        <label class="form-label">@Field.Label</label>
    }

    <input type="datetime-local"
           class="form-control @(Field?.Error != null ? "is-invalid" : "")"
           value="@GetDateTimeLocalValue()"
           @onchange="OnValueChanged"
           disabled="@(Field?.ReadOnly ?? false)" />

    @if (!string.IsNullOrEmpty(Field?.Error))
    {
        <div class="invalid-feedback d-block">
            @Field.Error
        </div>
    }

    @if (!string.IsNullOrEmpty(Field?.Warning))
    {
        <div class="text-warning">
            ⚠️ @Field.Warning
        </div>
    }

    @if (!string.IsNullOrEmpty(Field?.Hint))
    {
        <small class="form-text text-muted">@Field.Hint</small>
    }
</div>

@code {
    [Parameter]
    public DateTimeFieldViewModel? Field { get; set; }

    [Parameter]
    public EventCallback<DateTime> ValueChanged { get; set; }

    private string GetDateTimeLocalValue()
    {
        // datetime-local input expects format: yyyy-MM-ddTHH:mm
        return Field?.Value.ToString("yyyy-MM-ddTHH:mm") ?? string.Empty;
    }

    private async Task OnValueChanged(ChangeEventArgs e)
    {
        var value = e.Value?.ToString();

        if (!string.IsNullOrWhiteSpace(value) && DateTime.TryParse(value, out var dateTime) && Field != null)
        {
            Field.Value = dateTime;
            await ValueChanged.InvokeAsync(dateTime);
        }
    }
}
